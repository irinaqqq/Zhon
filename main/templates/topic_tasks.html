{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/topic_tasks.css' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task</title>

</head>
<body>
     
    <div class="container">
        {% include 'navbar.html' %}
        <div class="fixedImages">
            <div class="background"><img src="{% static 'images/vecteezy_blueprint-background-for-architect-drawing-building-plans-on_28697278-1.jpg' %}" alt=""></div>
            <img class="bgbottom" src="{% static 'images/bgbottom.svg' %}" alt="">
            <img class="blOver" src="{% static 'images/play-bl-over.svg' %}" alt="">
            <img class="brOver" src="{% static 'images/play-br-over.svg' %}" alt="">
            <img class="bmrUnder" src="{% static 'images/play-bmr-under.svg' %}" alt="">
            <img class="lmbUnder" src="{% static 'images/play-lmb-under.svg' %}" alt="">
            
        </div>
        <div class="label">
            <a href="{% url 'classroom' %}" class="btn"><img src="{% static 'images/icons/button-back.svg' %}"></a>
            <div class="lbl-nums">
                <h2 style="color: white; margin-left: 3vh;">{{ topic.name }}</h2>
                <div class="nums">
                    
                </div>
            </div>
            <a class="btn" href="{% url 'library' %}"><img src="{% static 'images/icons/button-bookmark-white.svg' %}"></a>
            
            <div class="lbl-nums">
            </div>
        </div>
        <div class="mainBlocksCenter">
            <div class="tools">
                <button id="pencil" onclick="init()"><img src="{% static 'images/icons/button-pencil.svg' %}"></button>
                <button value="erase" id="clr" onclick="erase()"><img src="{% static 'images/icons/button-eraser.svg' %}"></button>
            </div>
            <div class="board">
            
                <div class="brd-task">
                        
                        <!-- Отображение формы с вариантами ответов -->
                        <form method="post" >
                            {% csrf_token %}
                            <div class="task-text">
                               <p class="brd-task-text"></p>
                                    <input type="radio" id="choice1" name="choice" value="{{ task.choice1 }}">
                                    <label for="choice1"></label><br>
                                    <input type="radio" id="choice2" name="choice" value="{{ task.choice2 }}">
                                    <label for="choice2"></label><br>
                                    
                                        <input type="radio" id="choice3" name="choice" value="{{ task.choice3 }}">
                                        <label for="choice3"></label><br>
                                    
                                        <input type="radio" id="choice4" name="choice" value="{{ task.choice4 }}">
                                        <label for="choice4"></label><br>
                                   
                                    <!-- <label for="user_answer">Your Answer:</label>
                                    <input type="text" id="user_answer" name="user_answer" required> -->
                                
                                    <!-- Отображение других типов вопросов -->
                                    <!-- Добавьте логику для других типов вопросов -->
                              
                            </div>
                            
                
                            <!-- Кнопка для отправки ответа -->
                            <button type="button" onclick="checkAnswer()">Submit</button>
                            
                        </form>
                
                        <!-- Отображение результата проверки ответа -->
                        
                    
                        
                    <p class="result"></p>
                </div>
                <div class="brd-tools">
                    <button style="margin-left: 17vh;">↺</button>
                    <button>↶</button>
                    <button>↷</button>
                    <button id="submit">Тапсыру</button>
                </div>
            </div>
            <div class="ins-open">
                <button style="font-family: Hombre; font-size: 5.5vh;" onclick="openClsIns()"><img src="{% static 'images/icons/button-info.svg' %}" alt=""></button>
            </div>
    
            <div id="cls-ins" class=" overlay">
                <div class="overlay-content">
                    <div class="outer-ins">
                        <div><a href="javascript:void(0)" class="closebtn" onclick="closeClsIns()" style="font-family: Chelsea+Market;">&times;</a></div>
                        <div class="inner-ins">
                            <h2 style="font-size: 5vh; font-family: Hombre;">? Көмек</h2>
                            <div class="bubble">
                                <p style="font-size: 4vh; font-family: Hombre;">Қош келдіңіз!</p>
                            </div>
                            <img src="{% static 'img/girl.jpg' %}" alt="girl" style="width: 17vh; height: 17vh;">
                            <div class="inst-text-box">
                                <p>
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam lectus risus, finibus ornare vestibulum et, feugiat quis dui. Vivamus sit amet dolor et magna facilisis rhoncus. 
                                    <br>
                                    Curabitur maximus est sed porta scelerisque. Sed suscipit, arcu volutpat feugiat posuere, eros nisi tristique nibh, mollis vehicula lectus tortor eu purus. 
                                    <br>
                                    Donec ut tortor blandit, sagittis diam eget, suscipit eros. Quisque at magna neque. 
                                    Nulla faucibus mi at nunc mattis placerat. Pellentesque quis augue quis elit tristique auctor. Integer varius est orci, vel egestas felis dictum nec. 
                                    <br>
                                    Phasellus porta ex sit amet turpis finibus, sed vestibulum nisl efficitur. 
                                    <br>
                                    Praesent ultrices diam enim. In ut tellus sed sem placerat sollicitudin. 
                                    <br>
                                    Donec quis mollis dolor. Etiam viverra, arcu cursus porttitor porttitor, diam nunc auctor nisl, quis placerat magna erat et odio. 
                                    <br>
                                    Phasellus feugiat turpis quis mollis lacinia. Sed ac orci et nisi venenatis pharetra ac non arcu.
                                </p>
                            </div>
                        </div>
                            <div class="cls-ins-btn">
                                <button type="button" onclick="location.href='{% url 'library' %}'" style="width: 7vh; height: 7vh;"><img src="{% static 'img/mini-lib.png' %}"></button>
                                <button class="cls-start" onclick="closeClsIns()">Бастау</button>
                            </div>
                    </div>
                </div>
            </div>
        </div>
        

        
            <!-- <canvas id="can" width="870" height="450"></canvas> -->

           

        
        <!-- <h1>Tasks for Topic: {{ topic.name }}</h1> -->

        
      
    </div>
    <script type="application/json" id="tasks">
        {{ tasks|safe }}
        
    </script>
    

    <script>
    var currentId=0
    var currentTask
    function showTasksNums(tasks){
        var numsDiv = document.querySelector('.nums');
        // Loop through each task and add a number from 1 to the length of tasks
        for (var i = 0; i < tasks.length; i++) {
            // Create a new span element for each number
            var numberSpan = document.createElement('div');
            numsDiv.innerHTM=""
            // Set the text content of the span to the current number
            numberSpan.textContent = i+1;

            // If i is equal to currentId, add the 'active' class to the span
            if (i === currentId) {
                numberSpan.classList.add('active');
            }
            numsDiv.addEventListener('click', function(event) {
                currentId = parseInt(event.target.textContent) - 1;
            
            // Set currentTask to the task corresponding to the currentId
            currentTask = tasks[currentId];
            
            // Update the UI to show the current task
            showCurrentTask(currentTask);
            
            // Remove the 'active' class from all spans
            var allSpans = document.querySelectorAll('.nums div');
            allSpans.forEach(function(span) {
                span.classList.remove('active');
            });
            
            // Add the 'active' class to the clicked span
            event.target.classList.add('active');
            });
            // Append the span element to the numsDiv
            numsDiv.appendChild(numberSpan);
        }
    }
    function checkAnswer() {
    // Find all radio buttons with the name 'choice'
        var choices = document.getElementsByName('choice');
        var result = document.getElementsByClassName('result');
        // Loop through each radio button to check if it's checked
        for (var i = 0; i < choices.length; i++) {
            if (choices[i].checked && choices[i].id== currentTask.correct_answer) {
                // If checked, alert the ID of the checked choice
                document.querySelector('.result').textContent = "Correct";
                return; // Exit the function after finding the checked choice
            }else{
                document.querySelector('.result').textContent = "Incorrect";
                return
            }
        }

        // If none of the choices are checked
        alert("Please select an option.");
    }
    function getTaskById(tasks, targetId) {
        
            for(var i = 0; i < tasks.length; i++){
                // console.log(targetId,i)
                if(i==targetId){
                    return tasks[i]
                }
            }
        }
    function showCurrentTask(currentTask){
        
        // Update the HTML content with the properties of the currentTask object
        document.querySelector('.brd-task-text').textContent = currentTask.question;

        if (currentTask.question_type === 'MCQ' || currentTask.question_type === 'TF') {
            // Update radio button labels
            document.getElementById('choice1').value = currentTask.choice1;
            document.getElementById('choice1').nextElementSibling.textContent = currentTask.choice1;

            document.getElementById('choice2').value = currentTask.choice2;
            document.getElementById('choice2').nextElementSibling.textContent = currentTask.choice2;

            if (currentTask.choice3) {
                document.getElementById('choice3').value = currentTask.choice3;
                document.getElementById('choice3').nextElementSibling.textContent = currentTask.choice3;
            }

            if (currentTask.choice4) {
                document.getElementById('choice4').value = currentTask.choice4;
                document.getElementById('choice4').nextElementSibling.textContent = currentTask.choice4;
            }
        } else if (currentTask.question_type === 'OQ') {
            // Update the text input label
            document.querySelector('label[for="user_answer"]').textContent = "Your Answer:";
        }

       
    }
        
    document.addEventListener("DOMContentLoaded", function() {
        var tasksData=document.getElementById('tasks').textContent
        var tasks = tasksData.replace(/&#x27;/g, "'");
        tasks = tasksData.replace(/'/g, '"');
        tasks = JSON.parse(tasks);
        currentTask=getTaskById(tasks,currentId)
        showCurrentTask(currentTask)
       
        showTasksNums(tasks)
        


        var links = document.querySelectorAll('.lbl-nums a');
        links.forEach(function(link, index) {
            link.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent default link behavior
                var allDivs = document.querySelectorAll('.lbl-nums div');
                allDivs.forEach(function(div) {
                    div.classList.remove('active'); // Remove active class from all divs
                });
                // Add active class to the parent div of the clicked link
                link.parentNode.classList.add('active');
            });
        });
    });

    var canvas, ctx, flag = false,
        prevX = 0,
        currX = 0,
        prevY = 0,
        currY = 0,
        dot_flag = false;

    var selectedColor = "black";
    var selectedLineWidth = 2;
    var pencilActive = false;

    function init() {
        if (pencilActive) {
            canvas.removeEventListener("mousemove", findxy);
            canvas.removeEventListener("mousedown", findxy);
            canvas.removeEventListener("mouseup", findxy);
            canvas.removeEventListener("mouseout", findxy);
            pencilActive = false;
        } else {
            canvas = document.getElementById('can');
            ctx = canvas.getContext("2d");
            w = canvas.width;
            h = canvas.height;
            ctx.lineCap = "round"

            canvas.addEventListener("mousemove", findxy);
            canvas.addEventListener("mousedown", findxy);
            canvas.addEventListener("mouseup", findxy);
            canvas.addEventListener("mouseout", findxy);
            pencilActive = true;
        }
    }

    function color(obj) {
        selectedColor = obj.style.backgroundColor;
    }

    function line(obj) {
        switch (obj.id) {
            case "two":
                selectedLineWidth = 2;
                break;
            case "three":
                selectedLineWidth = 6;
                break;
            case "four":
                selectedLineWidth = 10;
                break;
        }
    }

    function draw() {
        ctx.beginPath();
        ctx.moveTo(prevX, prevY);
        ctx.lineTo(currX, currY);
        ctx.strokeStyle = selectedColor;
        ctx.lineWidth = selectedLineWidth;
        ctx.stroke();
        ctx.closePath();
    }

    function erase() {
        var m = confirm("Суретті өшіргіңіз келеді ме?");
        if (m) {
            ctx.clearRect(0, 0, w, h);
            document.getElementById("canvasimg").style.display = "none";
        }
    }

    function findxy(e) {
        if (e.type == 'mousedown') {
            prevX = currX;
            prevY = currY;
            currX = e.clientX - canvas.getBoundingClientRect().left;
            currY = e.clientY - canvas.getBoundingClientRect().top;

            flag = true;
            dot_flag = true;
            if (dot_flag) {
                ctx.beginPath();
                ctx.fillStyle = selectedColor;
                ctx.fillRect(currX, currY, 2, 2);
                ctx.closePath();
                dot_flag = false;
            }
        }
        if (e.type == 'mouseup' || e.type == "mouseout") {
            flag = false;
        }
        if (e.type == 'mousemove') {
            if (flag) {
                prevX = currX;
                prevY = currY;
                currX = e.clientX - canvas.getBoundingClientRect().left;
                currY = e.clientY - canvas.getBoundingClientRect().top;
                draw();
            }
        }
    }
    function openClsIns() {
        document.getElementById("cls-ins").style.display = "block";
    }

    function closeClsIns() {
        document.getElementById("cls-ins").style.display = "none";
    }
    </script>
</body>
</html>